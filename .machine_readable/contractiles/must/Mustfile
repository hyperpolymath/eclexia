# SPDX-License-Identifier: PMPL-1.0-or-later
# Mirror of repository invariant checks for machine-readable contractiles consumers

version: 1

checks:
  - name: root-mustfile-present
    run: "test -f Mustfile"

  - name: trustfile-present
    run: "test -f .machine_readable/contractiles/trust/Trustfile.a2ml"

  - name: intentfile-present
    run: "test -f .machine_readable/contractiles/lust/Intentfile"

  - name: hypatia-workflow-present
    run: "test -f .github/workflows/hypatia-scan.yml"

  - name: gitbot-fleet-hook-present
    run: "bash -euo pipefail -c 'rg -q gitbot-fleet .github/workflows/hypatia-scan.yml'"

  - name: ffi-pure-zig
    run: >
      bash -euo pipefail -c 'if find ffi -type f ! -name "*.zig" | grep -q .; then exit 1; fi'

  - name: abi-pure-idris2
    run: >
      bash -euo pipefail -c 'if find src/abi -type f ! -name "*.idr" | grep -q .; then exit 1; fi'

  - name: abi-extension-surface-present
    run: >
      bash -euo pipefail -c 'rg -q "ecl_abi_get_info" generated/abi/eclexia_ffi.h && rg -q "ecl_tracker_create_ex" generated/abi/eclexia_ffi.h && rg -q "ecl_tracker_snapshot" generated/abi/eclexia_ffi.h'
